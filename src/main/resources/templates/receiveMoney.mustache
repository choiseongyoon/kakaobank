{{>layout/top}}
<h2 class="ui dividing header" id="username">신다영</h2>
<h2 class="ui dividing header">송금된 내역</h2>

{{#errorMessage}}
    <div class="ui negative message">
        <i class="close icon"></i>
        <div class="header">
            오류!
        </div>
        <ul class="list">
            {{#messages}}
                <li>{{.}}</li>
            {{/messages}}
        </ul>
    </div>
{{/errorMessage}}

<table class="ui selectable celled striped table" id="receive-list">
    <thead>
    <tr>
        <th>거래번호</th>
        <th>고객이름</th>
        <th>금액</th>
        <th>마감날짜</th>
        <th>마감시간</th>
    </tr>
    </thead>
    <tbody>
    <!-- 사용자 반복 출력
     데이터가 있고, 순회형 자료구조면
     반복해서 처리해준다.
    -->
    {{#transactions}}
        <tr>
            <td>
                <!-- 사용자 반복 출력
                    객체 내부의 변수를 가져온다
                -->
                {{tId}}
            </td>
            <td>
                {{rName}}
            </td>
            <td>
                {{tAmount}}
            </td>
            <td>
                {{rDate}}
            </td>
            <td>
                {{rTime}}
            </td>
        </tr>
    {{/transactions}}
    </tbody>
</table>

<div>
    <!-- 사용자 추가삭제 부분 -->
    <form class="ui form" method="post">
        <div class="field">
            <input id="form-inputrAccId" type="hidden" name="rrAccId" placeholder="계좌번호 입력">
        </div>
        <div class="field">
            <input  id="form-tId" type="text" name="tId" placeholder="거래번호">
            <input  id="form-rName" type="text" name="rName" placeholder="수취인이름">
            <input  id="form-rAccId" type="text" name="rAccId" placeholder="수취인계좌번호">
        </div>

        <button class="ui primary button" type="submit" formaction="/receive/money">확인</button>
    </form>

    <script>
        $('.ui.dropdown').dropdown();
        <!-- 테이블 내, 줄 클릭하면 아래 입력 폼으로 보내주는 소스 -->
        $('#receive-list tbody tr').click(function() {
            $('input[name=rrAccId]').attr('type', "show");

            const td = $(this).children();

            const tId = td.eq(0).text().trim();
            const rName = td.eq(1).text().trim();
            const rAccId = $('#form-rAccId').val();

            $('#form-tId').val(tId);
            $('#form-rName').val(rName);

///////////////////////////////////

            const username = $('#username').text();
            const receivename = $('#form-rName').val();

            axios.post("/receive/verifyName", {
                    'username': username,
                    'receivename': receivename
                }).then((response) => {// 성공시

                }).catch((error) => {
                    $('#check-password').text(error.response.data.messages[0]);
                    location.href = "/receive/fail";
            })
        });
        $('#form-inputrAccId').keyup(function() {
            const rAccId = $('#form-inputrAccId').val();

            $('#form-rAccId').val(rAccId);
        });


    </script>
</div>
<!--axios.post("/send/verifyPassword", {-->
<!--        'baccPass': password,-->
<!--        'baccId': bacc_id-->
<!--    }).then((response) => {// 성공시-->
<!--        $('input[name=baccPass]').val(password);-->
<!--        $('#lastbutton').trigger("click");-->
<!--        $('.ui.modal.password').modal('hide');-->
<!--    }).catch((error) => {-->
<!--        $('#check-password').text(error.response.data.messages[0]);-->
<!--})-->